#!/bin/sh

usage() {
	echo "
usage: ${0##*/} [options] set

set menu for many desktop environments and applications
using ${SYSROOT}/etc/xdg/menus/puppy.menu

options:
  -sysroot <path>: set system root
"
	exit
}

MENUS='
applications.menu
cinnamon-applications.menu
gnome-applications.menu
gnome-flashback-applications.menu
kde4-applications.menu
kf5-applications.menu
lxde-applications.menu
lxlauncher-applications.menu
lxqt-applications.menu
mate-applications.menu
moblin-applications.menu
xfce-applications.menu
'

DOT_DIRECTORY='
Business-calc.directory|Calculator|calculator.svg|
Business.directory|Business|calculator.svg|
Business-finance.directory|Finance|calculator.svg|
Business-planner.directory|Planner|calculator.svg|
Business-spreadsheet.directory|Spreadsheet|calculator.svg|
Business-Sub.directory|Business|calculator.svg|
Desktop-appearance.directory|Appearance|desktop.svg|
Desktop-applet.directory|Applet|desktop.svg|
Desktop.directory|Desktop|desktop.svg|
Desktop-settings.directory|Settings|desktop.svg|
Desktop-sleep.directory|Sleep|desktop.svg|
Desktop-Sub.directory|Desktop|desktop.svg|
Desktop-windows.directory|Windows|desktop.svg|
Document-catalog.directory|Catalog|write.svg|
Document.directory|Document|write.svg|
Document-edit.directory|Edit|write.svg|
Document-layout.directory|Layout|write.svg|
Document-Sub.directory|Document|write.svg|
Document-utility.directory|Utility|write.svg|
Document-viewer.directory|Viewer|write.svg|
Filesystem.directory|Filesystem|directory.svg|
Filesystem-filemanager.directory|Filemanager|directory.svg|
Filesystem-find.directory|Find|directory.svg|
Filesystem-mount.directory|Mount|directory.svg|
Filesystem-storage.directory|Storage|directory.svg|
Filesystem-Sub.directory|Filesystem|directory.svg|
Fun-adventure.directory|Adventure|game.svg|
Fun-arcade.directory|Arcade|game.svg|
Fun-boardgame.directory|Board game|game.svg|
Fun-cardgame.directory|Card game|game.svg|
Fun.directory|Fun|game.svg|
Fun-puzzle.directory|Puzzle|game.svg|
Fun-shooter.directory|Shooter|game.svg|
Fun-Sub.directory|Fun|game.svg|
Graphic-camera.directory|camera|image.svg|
Graphic.directory|Graphic|image.svg|
Graphic-draw.directory|Draw|image.svg|
Graphic-flow.directory|Flow|image.svg|
Graphic-paint.directory|Paint|image.svg|
Graphic-print.directory|Print|image.svg|
Graphic-scanner.directory|Scanner|image.svg|
Graphic-Sub.directory|Graphic|image.svg|
Graphic-utility.directory|Utility|image.svg|
Graphic-viewer.directory|Viewer|image.svg|
Internet-block.directory|Block|internet.svg|
Internet-browser.directory|Browser|internet.svg|
Internet-chat.directory|Chat|internet.svg|
Internet.directory|Internet|internet.svg|
Internet-login.directory|Login|internet.svg|
Internet-mailnews.directory|Mail and News|internet.svg|
Internet-Sub.directory|Internet|internet.svg|
Internet-transfer.directory|Transfer|internet.svg|
Internet-utility.directory|Utility|internet.svg|
Multimedia-audiovideo.directory|Audio and Video|multimedia.svg|
Multimedia.directory|Multimedia|multimedia.svg|
Multimedia-mediaplayer.directory|Player|multimedia.svg|
Multimedia-optical.directory|Optical|multimedia.svg|
Multimedia-sound.directory|Audio|multimedia.svg|
Multimedia-Sub.directory|Multimedia|multimedia.svg|
Multimedia-utility.directory|Utility|multimedia.svg|
Network-connect.directory|Connect|network2.svg|
Network.directory|Network|network2.svg|
Network-firewall.directory|Firewall|network2.svg|
Network-phone.directory|Phone|network2.svg|
Network-Sub.directory|Network|network2.svg|
Network-transfer.directory|Transfer|network2.svg|
Network-utility.directory|Utility|network2.svg|
Office.directory|Office|spreadsheet.svg|
Personal-database.directory|Database|user.svg|
Personal-date.directory|Date|user.svg|
Personal.directory|Personal|user.svg|
Personal-education.directory|Education|user.svg|
Personal-Sub.directory|Personal|user.svg|
Personal-timing.directory|Timing|user.svg|
Setup.directory|Setup|preferences.svg|
Setup-installation.directory|Installation|preferences.svg|
Setup-puppy.directory|Puppy|preferences.svg|
Setup-Sub.directory|Setup|preferences.svg|
Setup-wizard.directory|Wizard|preferences.svg|
System.directory|System|preferences.svg|
System-memory.directory|Memory|preferences.svg|
System-print.directory|Print|preferences.svg|
System-process.directory|Process|preferences.svg|
System-security.directory|Security|preferences.svg|
System-storage.directory|Storage|preferences.svg|
System-Sub.directory|System|preferences.svg|
Utility-development.directory|Development|building_block.svg|
Utility.directory|Utility|building_block.svg|
Utility-help.directory|Help|building_block.svg|
Utility-package.directory|Package|building_block.svg|
Utility-shell.directory|Shell|building_block.svg|
Utility-Sub.directory|Utility|building_block.svg|
'

#===========================================================

[ -z "$1" ] && usage

for i in $@ ; do
	case $1 in
		-prefix|-sysroot) SYSROOT="$2" ; shift 2 ;;
		set|-set) PSET=1 ;;
		*) usage ;;
	esac
done

[ "$PSET" != "1" ] && exit

#=====================================================
#   /usr/share/desktop-directories/*.directory
#=====================================================

mkdir -p ${SYSROOT}/usr/share/desktop-directories
while IFS="|" read FILE DESC ICON ZZZ
do
	[ -z "$FILE" ] && continue
	echo $FILE
	(
	printf "[Desktop Entry]\n"
	printf "Encoding=UTF-8\n"
	printf "Name=${DESC}\n"
	printf "Icon=/usr/share/pixmaps/puppy/${ICON}\n"
	printf "Type=Directory\n"
	) > ${SYSROOT}/usr/share/desktop-directories/${FILE}
done <<EOF
$DOT_DIRECTORY
EOF

#=====================================================
#            /etc/xdg/menus/*.menu
#=====================================================

if [ -f ${SYSROOT}/etc/xdg/menus/puppy.menu ] ; then
	cd ${SYSROOT}/etc/xdg/menus
	cp puppy.menu pup.menu
	for i in $MENUS ; do
		rm -f $i
		ln -sv pup.menu $i
	done
else
	echo "ERROR: ${SYSROOT}/etc/xdg/menus/puppy.menu not found..."
	exit 1
fi

### END ###