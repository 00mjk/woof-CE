#!/bin/ash

. /etc/eventmanager
. /etc/rc.d/PUPSTATE

if [ "$PUPMODE" != "13" ] ; then
	exit
fi

if [ "$PM13_TRAYICON" = "false" ] ; then
	exit
fi

if [ "$1" = "cli" ] ; then
	echo
	echo -n "* Running in"
	echo -en "\\033[1;36m PUPMODE 13 \\033[0;39m "
	echo "(saving changes to RAM)"
	echo -n "* Type "
	echo -en "\\033[1;31msave2flash\\033[0;39m "
	echo "whenever you want to save session to pupsave"
fi

[ "$DISPLAY" ] || exit

if [ ! -e /tmp/pm13tray ] ; then
	yad=$(which yad 2>/dev/null)
	ln -s $yad /tmp/pm13tray
fi

yad=/tmp/pm13tray

if ! pidof ${yad##*/} >/dev/null 2>&1; then
	$yad --notification --command="eventmanager pm13" \
	--image=/usr/share/pixmaps/puppy/floppy.svg &
fi

