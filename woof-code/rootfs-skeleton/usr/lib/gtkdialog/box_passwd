#!/bin/sh
# password box
#
# USAGE:
#  box_passwd "title" "text" "show password" "ok label"
#
# all arguments are optional
#

export TEXTDOMAIN=box_passwd
export OUTPUT_CHARSET=UTF-8

TITLE="$(gettext 'Password')"
TEXT="$(gettext 'Enter password')"
SHOWP="$(gettext 'Show password')"
OK_LABEL="$(gettext 'OK')"

[ "$1" ] && TITLE="$1"
[ "$2" ] && TEXT="$2"
[ "$3" ] && SHOWP="$3"
[ "$4" ] && OK_LABEL="$4"

export MAIN='
<window title="'${TITLE}'" image-name="/usr/share/pixmaps/puppy/file_lock.svg">
  <vbox>
   <frame '${TEXT}'>
    <notebook show-tabs="false" show-border="false" visible="false">

      <vbox space-expand="true" space-fill="true">
        <entry caps-lock-warning="true" visibility="false">
          <variable>PASS_HIDDEN</variable>
          <input>echo "$PASS_SHOWN"</input>
          <action>refresh:PASS_SHOWN</action>
        </entry>
      </vbox>

      <vbox  space-expand="true" space-fill="true">
        <entry caps-lock-warning="true" visibility="true">
          <variable>PASS_SHOWN</variable>
          <input>echo "$PASS_HIDDEN"</input>
          <action>refresh:PASS_HIDDEN</action>
        </entry>
      </vbox>

      <variable>SWITCH</variable>
      <input>echo $(( (SWITCH+1) &1 ))</input>
    </notebook>

    <checkbox>
      <label>"'${SHOWP}'"</label>
      <action>refresh:SWITCH</action>
    </checkbox>

   </frame>

   <hbox space-expand="false" space-fill="false">
      <button>
         '"`/usr/lib/gtkdialog/xml_button-icon ok`"'
         <label>"'${OK_LABEL}'"</label>
       </button>
      <button>
         '"`/usr/lib/gtkdialog/xml_button-icon cancel`"'
         <label>"'$(gettext 'Cancel')'"</label>
       </button>
   </hbox>

  </vbox>

  <action signal="map-event">show:SWITCH</action>
  <action signal="map-event">grabfocus:PASS_HIDDEN</action>
</window>'

eval "`gtkdialog --center -p MAIN`"

if [ "$EXIT" = "OK" ] ; then
	if [ "$(echo $PASS_HIDDEN)" ] ; then
		echo "$PASS_HIDDEN"
		exit 0
	fi
fi

exit 1

### END ###
